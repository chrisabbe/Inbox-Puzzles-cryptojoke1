<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inbox Puzzles ‚Äì Daily Cryptojoke</title>
<style>
  :root {
    --teal: #1f9dbf;
    --gold: #f5b041;
    --gray: #555;
    --light-bg: #faf9f6;
  }
  body {
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    background: var(--light-bg);
    margin: 0;
    padding: 1.5em;
    display: flex;
    justify-content: center;
  }
  .puzzle-container {
    max-width: 640px;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 16px;
    padding: 1.5em 1.8em 2em 1.8em;
    box-shadow: 0 3px 10px rgba(0,0,0,0.05);
  }
  header {
    text-align: center;
    margin-bottom: 1.2em;
  }
  header img {
    width: 180px;
    max-width: 80%;
    display: block;
    margin: 0 auto 0.5em auto;
  }
  .tagline {
    font-size: 1rem;
    color: var(--gray);
    font-weight: 500;
    margin-bottom: 0.8em;
  }
  .title {
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--teal);
    margin-bottom: 0.6em;
  }
  .instructions {
    text-align: center;
    font-style: italic;
    color: #666;
    margin-bottom: 1.2em;
  }
  #cryptogram {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    font-family: monospace;
    font-size: 18px;
    line-height: 1.4;
    margin-bottom: 1.2em;
  }
  input[type=text] {
    width: 1.5em;
    text-align: center;
    text-transform: uppercase;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 2px;
    transition: border 0.2s ease, background 0.2s ease;
  }
  input[type=text]:focus {
    outline: none;
    border: 1px solid var(--teal);
    background: #e8f8fb;
  }
  .button-row {
    text-align: center;
    margin-top: 0.8em;
  }
  button {
    padding: 8px 14px;
    margin: 4px;
    border: none;
    border-radius: 8px;
    background: var(--teal);
    color: #fff;
    cursor: pointer;
    font-family: inherit;
    font-size: 15px;
    transition: background 0.2s ease, transform 0.1s ease;
  }
  button:hover {
    background: #18829e;
  }
  button:active {
    transform: scale(0.97);
  }
  #copyBtn {
    background: var(--gold);
    color: #333;
  }
  #copyBtn:hover {
    background: #d9951f;
    color: #fff;
  }
  #clearBtn {
    background: #888;
  }
  #clearBtn:hover {
    background: #666;
  }
  #linkArea {
    margin-top: 12px;
    text-align: center;
    word-break: break-all;
    font-size: 13px;
    color: #333;
  }
</style>
</head>
<body>
  <div class="puzzle-container">
    <header>
      <img src="910c424a-1830-4bf1-8bb0-2533a353baad.png" alt="Inbox Puzzles Logo">
      <div class="title">Daily Cryptojoke</div>
      <div class="tagline">Your daily dose of brain-teasing fun!</div>
    </header>

    <p class="instructions">
      Type your guesses below each letter. Click ‚ÄúGet Save Link‚Äù to continue later.
    </p>

    <div id="cryptogram"></div>

    <div class="button-row">
      <button id="saveBtn">üîó Get Save Link</button>
      <button id="copyBtn" style="display:none;">üìã Copy Link</button>
      <button id="clearBtn">üîÑ Clear My Answers</button>
    </div>

    <div id="linkArea"></div>
  </div>

<script>
(function(){
  const phrase = "FSW ROR DST CZQNTZNLF FOH QH QFQNR? MTZQACT ST FQC LADCDQHROHP OH SOC YOTIR.";
  const container = document.getElementById("cryptogram");
  const saveBtn = document.getElementById("saveBtn");
  const copyBtn = document.getElementById("copyBtn");
  const clearBtn = document.getElementById("clearBtn");
  const linkArea = document.getElementById("linkArea");
  let inputs = [];

  // --- Compression helpers (short URLs) ---
  function compress(obj){
    const pairs = Object.entries(obj).map(([k,v])=>k+v).join("|");
    const utf8 = new TextEncoder().encode(pairs);
    let bin = ""; utf8.forEach(b=>bin+=String.fromCharCode(b));
    return btoa(bin).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_");
  }
  function decompress(str){
    try{
      const b64=str.replace(/-/g,"+").replace(/_/g,"/");
      const bin=atob(b64);
      const bytes=new Uint8Array(bin.length);
      for(let i=0;i<bin.length;i++)bytes[i]=bin.charCodeAt(i);
      const decoded=new TextDecoder().decode(bytes);
      const obj={};
      decoded.split("|").forEach(p=>{
        if(p.length>2){
          const id=p.slice(0,-1);
          const val=p.slice(-1);
          obj[id]=val;
        }
      });
      return obj;
    }catch(e){return {};}
  }

  // --- Load from URL ---
  const params = new URLSearchParams(location.search);
  const saved = params.get("d") ? decompress(params.get("d")) : {};

  // --- Build puzzle ---
  phrase.split(" ").forEach((word, wIndex)=>{
    const wordDiv = document.createElement("div");
    wordDiv.style.display = "inline-flex";
    wordDiv.style.marginRight = "12px";
    wordDiv.style.flexWrap = "nowrap";

    word.split("").forEach((ch, cIndex)=>{
      if(/[A-Z]/.test(ch)){
        const cell = document.createElement("div");
        cell.style.display = "flex";
        cell.style.flexDirection = "column";
        cell.style.alignItems = "center";
        cell.style.width = "1.5em";

        const top = document.createElement("div");
        top.textContent = ch;
        top.style.fontWeight = "bold";
        top.style.marginBottom = "4px";
        top.style.color = "var(--teal)";

        const box = document.createElement("input");
        box.type = "text";
        box.maxLength = 1;
        box.addEventListener("input", e => e.target.value = e.target.value.toUpperCase());

        const id = wIndex + "-" + cIndex;
        if(saved[id]) box.value = saved[id];
        inputs.push({id,box});

        cell.appendChild(top);
        cell.appendChild(box);
        wordDiv.appendChild(cell);
      } else {
        const punct = document.createElement("div");
        punct.textContent = ch;
        punct.style.marginLeft = "4px";
        punct.style.fontWeight = "bold";
        punct.style.color = "var(--teal)";
        wordDiv.appendChild(punct);
      }
    });
    container.appendChild(wordDiv);
  });

  // --- Generate Save Link ---
  saveBtn.addEventListener("click", ()=>{
    const current = {};
    inputs.forEach(({id,box})=>{ if(box.value) current[id]=box.value; });
    const compact = compress(current);
    const url = new URL(window.location.href.split("?")[0]);
    url.searchParams.set("d", compact);
    linkArea.innerHTML = `üìé <strong>Your Save Link:</strong><br><a href="${url}" target="_blank">${url}</a><br><em>(Copy or bookmark this link to resume later.)</em>`;
    copyBtn.style.display = "inline-block";
    copyBtn.dataset.url = url;
  });

  // --- Copy Link ---
  copyBtn.addEventListener("click", ()=>{
    const link = copyBtn.dataset.url;
    navigator.clipboard.writeText(link).then(()=>{
      copyBtn.textContent = "‚úÖ Copied!";
      setTimeout(()=>copyBtn.textContent = "üìã Copy Link", 1500);
    });
  });

  // --- Clear Answers ---
  clearBtn.addEventListener("click", ()=>{
    inputs.forEach(({box})=>box.value="");
    linkArea.textContent = "";
    copyBtn.style.display = "none";
    history.replaceState({}, "", location.pathname);
  });
})();
</script>
</body>
</html>
